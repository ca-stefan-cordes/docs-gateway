= Configuring TLS Context for Flex Gateway in Connected Mode
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../assets/images
:page-mode: conn

Using HTTPS protects the communication between the client and Flex Gateway with encryption. To use HTTPS as your schema
when creating an API Instance using Flex Gateway Connected Mode, you must xref:anypoint-security::secret-group-add-tls-context-flex.adoc[add a TLS context for Flex Gateway in secrets manager]. 

Flex Gateway supports inbound and outbound TLS and mutual authentication TLS (mTLS) for the outbound connection.

TLS context configuration for a Flex Gateway Connected Mode is the same whether it is running in a Docker container, as a Linux Service, or as a Kubernetes Ingress controller.

Before configuring the TLS context for a Flex Gateway Connected Mode, you must complete the following tasks:

* xref:flex-install.adoc[Install Flex Gateway]
* xref:flex-{page-mode}-reg-run.adoc[Register and Run Flex Gateway]
* xref:anypoint-security::asm-secret-group-creation-task.adoc[Create a Secret Group]
* xref:anypoint-security::secret-group-add-tls-context-flex.adoc[Add a TLS Context to Flex Gateway Connected Mode]

== Add TLS Context to an API

To add TLS Context to an API Instance in Flex Gateway Connected mode:

. Go to *Anypoint Platform > API Manager*.

. Create a new API Instance deployed with Flex Gateway or edit the endpoint of an existing Flex Gateway API Instance:

* To the create a new API using Flex Gateway as the runtime, complete the xref:docs-api-manager::create-instance-task.adoc[Adding an API Instance] task up to the endpoint configuration page.

* To edit an the existing existing endpoint of an API Instance, in *API Administration* click the name of the API you want to add TLS context to, then *Runtime & Endpoint Configuration*. 

. Configure the end point up to *Scheme*. For more information on configuration, see xref:api-manager::configure-api-task.adoc#configure-an-api-instance-on-flex-gateway-options[Configure an API Instance on Flex Gateway Options].

. Select *HTTPS*.

. Specify the *Port*.

. Add TLS context for inbound traffic, outbound traffic, or both:

+
To add TLS context for either traffic direction:
+

.. Click *Add TLS Context*.

.. Select a *Secret Group*.

.. Select a *TLS Context*.

.. Click *Ok*.

. Click *Next* or *Save & Apply*.


// intro and graphics for each option - linux, docker, k8s
include::partial$task-tls-config.adoc[tags=intro1;intro2;intro3;icon-table;byb;linux;sample-config-all-intro]
// configure TLS context for Flex Gateway as a Linux Service
+
include::partial$task-tls-config.adoc[tags=sample-config-all]
+
include::partial$task-tls-config.adoc[tags=sample-config-instance-intro]
+
include::partial$task-tls-config.adoc[tags=sample-config-instance]
+
include::partial$task-tls-config.adoc[tags=sample-config-mtls-intro]
+
include::partial$task-tls-config.adoc[tags=sample-config-mtls]
+
include::partial$task-tls-config.adoc[tags=verify-config]
+
include::partial$task-tls-config.adoc[tags=config-ref]

// configure TLS context for Flex Gateway in a Docker container
include::partial$task-tls-config.adoc[tags=docker-intro]
+
include::partial$task-reg-run-flex-gateway.adoc[tags=start-command-local]
+
include::partial$task-tls-config.adoc[tags=sample-config-all-intro]
+
include::partial$task-tls-config.adoc[tags=sample-config-all]
+
include::partial$task-tls-config.adoc[tags=sample-config-instance-intro]
+
include::partial$task-tls-config.adoc[tags=sample-config-instance]
+
include::partial$task-tls-config.adoc[tags=sample-config-mtls-intro]
+
include::partial$task-tls-config.adoc[tags=sample-config-mtls]
+
include::partial$task-tls-config.adoc[tags=verify-config]
+
include::partial$task-tls-config.adoc[tags=config-ref]

//configure TLS context for Flex Gateway as an K8s Ingress Controller
include::partial$task-tls-config.adoc[tags=k8s-intro]

include::partial$task-tls-config.adoc[tags=sample-config-all-intro]

include::partial$task-tls-config.adoc[tags=sample-config-all]

include::partial$task-tls-config.adoc[tags=sample-config-instance-intro]

include::partial$task-tls-config.adoc[tags=sample-config-instance]

include::partial$task-tls-config.adoc[tags=sample-config-mtls-intro]

include::partial$task-tls-config.adoc[tags=sample-config-mtls]

include::partial$task-tls-config.adoc[tags=config-ref]

== See Also

* xref:flex-local-tls-config.adoc[Configuring TLS Context for Flex Gateway in Local Mode]
* xref:policies::policies-included-tls.adoc[Transport Layer Security Policy]