= Installing Flex Gateway
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../assets/images


Install Flex Gateway as a Kubernetes Ingress Controller, as a Linux Service, or in a Docker container. 

[cols="1,1,1"]
|===

|image:install-linux-logo.png[20%,20%,xref="flex-install.adoc#install-as-a-linux-service"]

|image:install-docker-logo.png[25%,25%,xref="flex-install.adoc#install-in-a-docker-container"]

|image:install-kubernetes-logo.png[20%,20%,xref="flex-install.adoc#install-as-a-kubernetes-ingress-controller"]

|xref:flex-install.adoc#install-as-a-linux-service[Install as a Linux Service]

|xref:flex-install.adoc#install-in-a-docker-container[Install in a Docker Container]

|xref:flex-local-installing-running.adoc#install-and-run-as-a-kubernetes-ingress-controller[Install as a Kubernetes Ingress Controller]

|===

== Install as a Linux Service

=== Before You Begin

Before getting started, ensure you have installed the following: 

* curl 
* vim
* gnupg2
* lsb-release
* systemctl

.To install Flex Gateway as a Linux Service: 

Retrieve the public package keys and add the package repository, update the package list, update apt-get,
and install the Flex Gateway package using the following commands: 

[source]
----
curl -XGET https://flex-packages.devx.anypoint.mulesoft.com/ubuntu/pubkey.gpg | sudo apt-key add -

echo "deb https://flex-packages.devx.anypoint.mulesoft.com/ubuntu $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/mulesoft.list

sudo apt update

sudo apt install -y peregrine
----

== Install in a Docker Container

.To install Flex Gateway in a Docker Container: 

. Download the Flex Gateway Docker image using the following command: 
+
[source]
----
curl -o flex-gateway-1.0.0-beta.5.tar https://peregrine:48bcfd4617c9cce@d8wbbsqfcfi8u.cloudfront.net/docker/flex-gateway-1.0.0-beta.5.tar
----

. Move the container image into a directory of your choice.

. Using the command line interface, navigate to the directory containing the container image.

. Install the container image using the following command: 
+
[source]
----
docker load --input flex-gateway-1.0.0-beta.5.tar
----

You can verify the installation was successful using the following command: 

[source]
----
docker images
----

The Flex Gateway container image should appear in the resulting list, for example: 

[source]
----
REPOSITORY                   TAG              IMAGE ID       CREATED        SIZE
mulesoft/flex-gateway        1.0.0-beta.5     1c1fbdbf819b   9 days ago     334MB
----

== Install as a Kubernetes Ingress Controller

The following procedures demonstrate how to install and run Flex Gateway as an ingress controller.

=== Dependencies

* A tool to create Kubernetes clusters. The following examples use https://k3d.io/v5.0.0/#installation[k3d^].
* https://kubernetes.io/docs/tasks/tools/#kubectl[kubectl,^] a tool used to interact with Kubernetes clusters.
* https://helm.sh/docs/intro/install/[Helm,^] a tool used to install Flex Gateway, monitoring tools and applications. A minimum Helm version of 3.0.0 is required.

=== Prepare the Environment

. Create a new Kubernetes cluster with a single server node using the following command: 
+
[source]
----
k3d cluster create flex-gateway-1 --k3s-arg "--disable=traefik@server:*" --port '80:80@server:*' --port '443:443@server:*'
----
+
The command should return the following success message: 
+
----
INFO[0042] Cluster 'flex-gateway-1' created successfully!
----

. Download the Flex Gateway container image using the following command: 
+
----
curl -o flex-gateway-1.0.0-beta.5.tar https://peregrine:48bcfd4617c9cce@d8wbbsqfcfi8u.cloudfront.net/docker/flex-gateway-1.0.0-beta.5.tar
----

. Import the container image using the following command: 
+
----
k3d image import -c flex-gateway-1 flex-gateway-1.0.0-beta.5.tar
----
+
The command should return the following success messages: 
+
----
INFO[0016] Successfully imported image(s)
INFO[0016] Successfully imported 1 image(s) into 1 cluster(s)
----

=== Procedure 

. Add the Flex Gateway helm repository using the following command: 
+
----
helm repo add flex-gateway https://peregrine:48bcfd4617c9cce@d8wbbsqfcfi8u.cloudfront.net/helm
----

. Update the helm repository using the following command:
+
----
helm repo up
----

. Install the *flex-gateway* helm chart into the *gateway* namespace with ingress using the following command:  
+
----
helm -n gateway upgrade -i --wait --create-namespace ingress flex-gateway/flex-gateway
----
+
The command should return something like the following: 
+
----
NAME: ingress
LAST DEPLOYED: Tue Oct 19 13:08:07 2021
NAMESPACE: gateway
STATUS: deployed
REVISION: 1
TEST SUITE: None
----

You can verify *apiinstances* was created during installation using the following command: 
+
----
kubectl -n gateway get apiinstances
---- 
+
The command returns output similar to the following: 
+
----
NAME            ADDRESS
ingress-http    http://0.0.0.0:80
ingress-https   http://0.0.0.0:443
----
